<script>
    // 【変更】エンジンの常駐化（ボタンを押す前に準備を済ませる）
    let globalWorker = null;
    async function initWorker() {
        globalWorker = await Tesseract.createWorker('jpn+eng');
        addLog("✅ OCR Engine Standby.");
    }

    // 【変更】スキャン実行部分のロジック
    scanBtn.onclick = async () => {
        // 1. ガイド枠の部分だけを切り抜き（クロップ）
        const cropX = canvas.width * 0.1; // 左右10%を除外
        const cropY = canvas.height * 0.4; // 上下の中央付近だけ抽出
        const cropW = canvas.width * 0.8;
        const cropH = canvas.height * 0.2;
        
        const croppedCanvas = document.createElement('canvas');
        croppedCanvas.width = cropW;
        croppedCanvas.height = cropH;
        const croppedCtx = croppedCanvas.getContext('2d');
        croppedCtx.drawImage(canvas, cropX, cropY, cropW, cropH, 0, 0, cropW, cropH);

        // 2. 切り抜いた「軽い画像」だけを解析に回す
        const { data: { text } } = await globalWorker.recognize(croppedCanvas);
        // ...
    };
</script>
